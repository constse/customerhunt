{#<script>#}
var hunter_formhandler_action = '{{ action|e }}';
var hunter_formhandler_handlers = {{ handlers|raw }};

function hunter_formhandler_init() {
    var handlers_count = hunter_formhandler_handlers.length;
    for (var i = 0; i < handlers_count; ++i) {
        var handler = hunter_formhandler_handlers[i];
        var form = $(handler.selector);
        form.unbind('submit');
        form.attr('action', hunter_formhandler_action);
        var hidden = $('<input type="hidden" name="hunter_form_id" value="">')
        hidden.attr('value', handler.id);
        form.append(hidden);
        hidden = $('<input type="hidden" name="hunter_query" value="">')
        hidden.attr('value', $(window.location.search.substring(1)));
        form.append(hidden);
        form.submit(function(e) {
            $.ajax({
                cache: false,
                data: $(this).serialize(),
                dataType: 'json',
                error: function() { $(location).attr('href', handler.error_redirect); },
                method: 'GET',
                success: function() { $(location).attr('href', handler.success_redirect); },
                url: hunter_formhandler_action
            });
            e.preventDefault();
            return false;
        });
    }
}

hunter_formhandler_init();
{#</script>#}